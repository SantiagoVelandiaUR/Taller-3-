import pandas as pd
import matplotlib as mpl
import matplotlib.pyplot as plt
import numpy as np
from pathlib import Path
import pingouin as pg

#Archivo Guardado
# Descarga Base de Datos Nasa
nasa_url = "https://data.giss.nasa.gov/gistemp/tabledata_v3/NH.Ts+dSST.csv"

# Lee el archivo directo desde el internet
df = pd.read_csv(nasa_url, skiprows=1)  # Usar skiprows=1 si la primera fila son notas y no los encabezados

# Paso 2: Gráfico de Junio
plt.figure(figsize=(10,6))
plt.plot(df['Year'], df['Jun'], color='blue', label='Anomalía Junio')
plt.axhline(0, color='gray', linestyle='--', label='promedio de 1951 a 1980')
plt.xlabel('Año')
plt.ylabel('Anomalía de Temperatura (°C)')
plt.title('Anomalía de Temperatura en Junio (Hemisferio Norte)')
plt.legend()
#plt.savefig('graficos/Anomalia_Junio.png')
plt.show()

# Forzar datos de estaciones a tipo numérico: convierte errores en NaN
for col in ['DJF', 'MAM', 'JJA', 'SON']:
    df[col] = pd.to_numeric(df[col], errors='coerce')

# SÓLO conserva filas con datos completos en todas las estaciones
df_clean = df[['Year', 'DJF', 'MAM', 'JJA', 'SON']].dropna()

# Graficar
plt.figure(figsize=(10,6))
plt.plot(df_clean['Year'], df_clean['DJF'], label='Invierno (DJF)')
plt.plot(df_clean['Year'], df_clean['MAM'], label='Primavera (MAM)')
plt.plot(df_clean['Year'], df_clean['JJA'], label='Verano (JJA)')
plt.plot(df_clean['Year'], df_clean['SON'], label='Otoño (SON)')
plt.axhline(0, color='gray', linestyle='--', label='promedio de 1951 a 1980')
plt.xlabel('Año')
plt.ylabel('Anomalía de Temperatura (°C)')
plt.title('Anomalía de Temperatura por Estación (Hemisferio Norte)')
plt.legend()
plt.tight_layout()
plt.savefig('graficos/Anomalia_Estaciones_limpio.png')
plt.show()
